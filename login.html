<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="referrer" content="origin"/>
    <meta http-equiv="Access-Control-Allow-Origin" content="*" />
    <link rel="shortcut icon" href="#" type="image/png">

    <title>登陆</title>

    <link href="css/style.css" rel="stylesheet">
    <!-- 响应式样式 -->
    <link href="css/style-responsive.css" rel="stylesheet">
</head>

<body class="login-body">

<div class="container">

    <div class="form-signin">
        <div class="form-signin-heading text-center">
            <h1 class="sign-title">登录</h1>
            <img src="images/login-logo.png" alt=""/>
        </div>
        <form class="login-wrap" method="get" action="" id="signupForm">
            <input  class="form-control" type="text" placeholder="用户名/手机号" autofocus name="phone" id="phone">
            <input  class="form-control" type="password" placeholder="密码" name="password" id="password">
            <select class="form-control" size="1" aria-controls="dynamic-table" id="identify">
                <option value="1" selected="selected">学生</option>
                <option value="2">教师</option>
            </select>

            <botton class="btn btn-lg btn-login btn-block" id="submit" href="" data-toggle="modal">
                <i class="fa fa-check"></i>
            </botton>

            <div class="registration">
                还没有账号?
                <a class="" href="registration.html" id="test">
                    去注册
                </a>
            </div>
            <label class="checkbox">
                <input type="checkbox" value="remember-me"> 记住密码
                <span class="pull-right">
                    <a data-toggle="modal" href="#myModal"> 忘记密码?</a>

                </span>
            </label>
        </form>
        <!-- Modal -->
        <div aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form id="forgetForm">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">忘记了密码 ?</h4>
                    </div>
                    <div class="modal-body">
                        <p>输入您的手机号与电子邮件地址并重新设置您的密码.</p>
                        <input type="text"  placeholder="手机号" autocomplete="off" class="form-control placeholder-no-fix" name="phone" id="forgetPhone">
                        <input type="text" placeholder="邮箱" autocomplete="off" class="form-control placeholder-no-fix" name="email" id="email">
                        <input type="password"  placeholder="新密码" autocomplete="off" class="form-control placeholder-no-fix" name="password" id="forget_password">
                        <input type="password"  placeholder="确认密码" autocomplete="off" class="form-control placeholder-no-fix" name="confirm_password" id="confirm_password">
                        <select class="form-control" size="1" name="identify" aria-controls="dynamic-table" id="forgetIdentify">
                            <option value="1" selected="selected">学生</option>
                            <option value="2">教师</option>
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button data-dismiss="modal" class="btn btn-default" type="button">取消</button>
                        <botton class="btn btn-primary" type="button" href="" data-toggle="modal" id="confirmSubmit">提交</botton>
                    </div>
                    </form>
                </div>
            </div>
        </div>
        <!-- modal -->
        <!-- 密码错误 -->
        <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="wrong" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">用户名或密码错误！</h4>
                    </div>
                    <div class="modal-body">
                        <p>请重新输入您的用户名和密码！</p>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
        <!-- wrong-->
        <!-- 格式错误-->
        <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="wrongFormat" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title">输入格式错误！</h4>
                    </div>
                    <div class="modal-body">
                        <p>请重新输入您的信息！</p>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
        <!-- 密码修改成功-->
        <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="rightChange" class="modal fade">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">密码修改成功！</h4>
                    </div>
                    <div class="modal-body">
                        <p>请点击确认按钮重新登陆。</p>
                    </div>
                    <div class="modal-footer">
                        <botton class="btn btn-primary" type="button" href="login.html" data-toggle="modal" id="changeSubmit">确认</botton>
                    </div>
                </div>
            </div>
        </div>


    </div>

</div>


<!-- Placed js at the end of the document so the pages load faster -->

<!-- Placed js at the end of the document so the pages load faster -->
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/modernizr.min.js"></script>
<script type="text/javascript" src="js/jquery.validate.min.js"></script>
<script src="js/validation-init.js"></script>
<script src="js/url.js"></script>
<script>
    //登陆
    $(function () {
        //完整业务
        $("#submit").click(function () {

        })
        /*
        $("#submit").click(function () {
            var flag = signupValidator.form();
            alert(flag);
            if (flag) {
                var identifier =$("#identify").val();
                var loginUrl=url;   //防止api复用错误
                if(identifier=="1"){    //识别身份向不同接口发信息
                    loginUrl+="student/login";
                }else {
                    loginUrl+="teacher/login";
                }
                var d = {};
                var t = $("#signupForm").serializeArray();
                $.each(t, function () {
                    d[this.name] = this.value;
                });
                alert("提交数据：" + JSON.stringify(d)+url);
                $.ajax({
                    type: "POST",
                    url: loginUrl,  //等待ing
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify(d),
                    async: false,   //同步执行
                    dataType: "json",
                    success: function (message) {
                        alert(message);
                        var context = message["responseText"];
                        var contextJson = JSON.parse(context);
                        var code=contextJson["code"];
                        var data=contextJson["data"];
                        var dataJson=JSON.parse(data);
                        var token=dataJson["accesstoken"];
                        alert(code);
                        if (code == "1") {
                            if (identifier=="1"){
                                alert("学生登陆成功");
                                $("#submit").attr("href","student_information.html");
                                localStorage.setItem("token",token); //存储token
                            }else{
                                $("#submit").attr("href","teacher_myinfo.html");
                            }
                        }else{
                            $("#submit").attr("href","#wrong");
                        }
                    },
                    error: function (message) {
                        $("#submit").attr("href", "");
                        alert("未连接后端");
                        alert(JSON.stringify(message));
                    }
                })
            }else{
                $("#submit").attr("href", "#wrongFormat");
            }
        })*/
    })
</script>
<script>
    //忘记密码
    $(function () {
        $("#confirmSubmit").click(function () {
            var flag= forgetValidator.form();
            alert(flag);
                if (flag) {
                    var forgetUrl=url;
                    var identifier =$("#forgetIdentify").val();
                    if(identifier=="1"){    //识别身份
                        forgetUrl+="student/forget";
                    }else{
                        forgetUrl+="teacher/forget";
                    }
                    var d = {};
                    var t = $("#forgetForm").serializeArray();
                    $.each(t, function () {
                        d[this.name] = this.value;
                    });
                    alert("提交数据：" + JSON.stringify(d));
                    $.ajax({
                        type:"POST",
                        url:forgetUrl,  //等待ing
                        contentType:"application/json;charset=utf-8",
                        data: JSON.stringify({
                            "phone":d["phone"],
                            "email":d["email"],
                            "password":d["password"]
                        }),
                        dataType: "json",
                        success:function (message) {
                            var context=message["responseText"];
                            var contextJson=JSON.parse(context);
                            var code=contextJson["code"];
                            if(code=="1"){
                                $("#submit").attr("href","rightChange");
                            }else{
                                $("#confirmSubmit").attr("href","");
                                alert("修改失败！");
                            }
                        },
                        error:function (message) {
                            $("#confirmSubmit").attr("href","");
                            alert("未连接后端");
                        }
                    })
                }else{
                    $("#confirmSubmit").attr("href", "#wrongFormat");
                }
        })
    })
</script>
</body>
</html>
